<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Getting the size of a NSAttributedString</title>
  <meta name="description" content="In iOS7 the sizeWithFont methods for the NSString class are deprecated. I think this has to do with the complete move to NSAttributedString that Apple has in...">

  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/main.css">
  
<!--  <link rel="stylesheet" href="/css/main.css"> -->
  <link rel="canonical" href="http://cocoa.ninja/posts/Getting-the-size-of-a-NSAttributedString">
  <link rel="alternate" type="application/rss+xml" title="cocoa.ninja" href="http://cocoa.ninja/feed.xml" />
  
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>	    
      <a class="navbar-brand" href="/">
         cocoa.ninja
      </a>
    </div>
  
	  <div class="collapse navbar-collapse">
	      <ul class="nav navbar-nav navbar-right">
		      <li>
			  	<a href="https://twitter.com/depl0y">
					<img src="/img/svg/twitter.svg">
				</a>
	        
			</li>
	     
			<li class="icon  icon--github">
				<a href="https://github.com/depl0y">
					<img src="/img/svg/github.svg">
				</a>
			</li>	 
		
		
			<li class="icon icon--mail">
				<a href="mailto:wim@sortedbits.com">
					<img src="/img/svg/mail.svg">
				</a>
			</li>
			
			<li class="icon icon--so">
				<a href="http://stackoverflow.com/users/69313/wim-haanstra">
					<img src="/img/svg/stackoverflow.svg">
				</a>
			</li>
			
			
			<li class="icon icon--so">
				<a href="skype:wimhaanstra" id="skype_call_wim">
					<img src="/img/svg/skype.svg">
				</a>
			</li>
	  	</ul>
	  </div>
  </div>
</nav>


    <div class="container">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Getting the size of a NSAttributedString</h1>
  </header>
</div>

<div class="post-info">
	<div class="author-avatar">
		<img src="http://www.gravatar.com/avatar/0ec84fc5efb4f0dc7db5df8bf6bb41b9.png">
	</div>
	<div class="details">
		<div class="row">
			<div class="col-md-12 author-name">
				Wim Haanstra
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 post-subtitle">
				This post was created on <span class="post-date">February 13, 2014</span>.
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 tags">
		   		
		   			<span class="tag">objC</span>
		   		
		   			<span class="tag">NSAttributedString</span>
		   		
			</div>
		</div>
	</div>
</div>


<div class="post">
  <article class="post-content">
    <p>In iOS7 the <code>sizeWithFont</code> methods for the <code>NSString</code> class are deprecated. I think this has to do with the complete move to <code>NSAttributedString</code> that Apple has in mind, which does give developers a lot more options for styling.</p>

<p>But of course, we use those methods a lot, so we need to use the replacement method Apple has implemented for us: <code>boundingRectWithSize</code>, but this method is not really documented that well. Results are weird when you first start out using it or in the worse case, the method does not seem to work at all.
<!-- more -->
I have been struggling to get this to work and one of the problems was, that the <code>boundingRectWithSize</code> gave me a rectangle that was just 1 line in height.</p>

<p>The solution, in the end, was fairly simple, supply a <code>NSMutableParagraphStyle</code>. So here is a piece of code, which is actually an extension to the <code>NSString</code> class.</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="lineno"> 1</span> <span class="k">@interface</span> <span class="bp">NSString</span> <span class="nl">(Size)</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="p">-</span> <span class="p">(</span><span class="bp">CGSize</span><span class="p">)</span> <span class="nf">attributedSizeWithFont:</span><span class="p">(</span><span class="bp">UIFont</span><span class="o">*</span><span class="p">)</span> <span class="nv">font</span><span class="p">;</span>
<span class="lineno"> 4</span> <span class="p">-</span> <span class="p">(</span><span class="bp">CGSize</span><span class="p">)</span> <span class="nf">attributedSizeWithFont:</span><span class="p">(</span><span class="bp">UIFont</span><span class="o">*</span><span class="p">)</span> <span class="nv">font</span> <span class="nf">maxWidth:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="nv">width</span><span class="p">;</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span> <span class="k">@end</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="k">@implementation</span> <span class="bp">NSString</span> <span class="nl">(Size)</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> <span class="p">-</span> <span class="p">(</span><span class="bp">CGSize</span><span class="p">)</span> <span class="nf">attributedSizeWithFont:</span><span class="p">(</span><span class="bp">UIFont</span><span class="o">*</span><span class="p">)</span> <span class="nv">font</span> <span class="p">{</span>
<span class="lineno">11</span>     <span class="k">return</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">attributedSizeWithFont</span><span class="p">:</span><span class="n">font</span> <span class="nl">maxWidth</span><span class="p">:</span><span class="n">CGFLOAT_MAX</span><span class="p">];</span>
<span class="lineno">12</span> <span class="p">}</span>
<span class="lineno">13</span> 
<span class="lineno">14</span> <span class="p">-</span> <span class="p">(</span><span class="bp">CGSize</span><span class="p">)</span> <span class="nf">attributedSizeWithFont:</span><span class="p">(</span><span class="bp">UIFont</span><span class="o">*</span><span class="p">)</span> <span class="nv">font</span> <span class="nf">maxWidth:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="nv">width</span> <span class="p">{</span>
<span class="lineno">15</span> 
<span class="lineno">16</span>     <span class="bp">NSMutableParagraphStyle</span><span class="o">*</span> <span class="n">style</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSMutableParagraphStyle</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
<span class="lineno">17</span>     <span class="n">style</span><span class="p">.</span><span class="n">lineBreakMode</span> <span class="o">=</span> <span class="n">NSLineBreakByWordWrapping</span><span class="p">;</span>
<span class="lineno">18</span>     
<span class="lineno">19</span>     <span class="bp">NSAttributedString</span> <span class="o">*</span><span class="n">attributedText</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSAttributedString</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithString</span><span class="p">:</span><span class="nb">self</span>
<span class="lineno">20</span>         <span class="nl">attributes</span><span class="p">:</span><span class="l">@{</span> <span class="nl">NSFontAttributeName</span><span class="p">:</span><span class="n">font</span><span class="p">,</span>
<span class="lineno">21</span>         <span class="nl">NSForegroundColorAttributeName</span><span class="p">:[</span><span class="bp">UIColor</span> <span class="n">blackColor</span><span class="p">],</span>
<span class="lineno">22</span>         <span class="nl">NSParagraphStyleAttributeName</span><span class="p">:</span><span class="n">style</span> <span class="l">}</span>
<span class="lineno">23</span> 	<span class="p">];</span>
<span class="lineno">24</span> 
<span class="lineno">25</span>     <span class="bp">CGRect</span> <span class="n">textRect</span> <span class="o">=</span> <span class="p">[</span><span class="n">attributedText</span> <span class="nl">boundingRectWithSize</span><span class="p">:</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">CGFLOAT_MAX</span><span class="p">)</span>
<span class="lineno">26</span> 							<span class="nl">options</span><span class="p">:(</span><span class="n">NSStringDrawingUsesLineFragmentOrigin</span><span class="p">)</span>
<span class="lineno">27</span> 							<span class="nl">context</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="lineno">28</span>     <span class="bp">CGSize</span> <span class="n">size</span> <span class="o">=</span> <span class="n">textRect</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
<span class="lineno">29</span>     <span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">ceilf</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
<span class="lineno">30</span>     <span class="n">size</span><span class="p">.</span><span class="n">width</span>  <span class="o">=</span> <span class="n">ceilf</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">);</span>
<span class="lineno">31</span> 
<span class="lineno">32</span>     <span class="k">return</span> <span class="n">size</span><span class="p">;</span>
<span class="lineno">33</span> <span class="p">}</span>
<span class="lineno">34</span> 
<span class="lineno">35</span> <span class="k">@end</span></code></pre></div>

  </article>
</div>


<div id="disqus_thread" class="comments">
  <script type="text/javascript">
      var disqus_shortname = 'cocoaninja';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


    </div>

    <footer class="footer">
	<div class="container">
		<p class="text-muted">&copy; 2015 - Wim Haanstra</p>
	</div>
</footer>

	<script type="text/javascript" src="/js/jquery-1.11.2.min.js"></script>
	<script type="text/javascript" src="/js/bootstrap.min.js"></script>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	
	  ga('create', 'UA-15884210-11', 'auto');
	  ga('send', 'pageview');
	
	</script>
	
  </body>

</html>
