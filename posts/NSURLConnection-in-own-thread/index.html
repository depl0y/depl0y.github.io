<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>NSURLConnection in its own thread</title>
  <meta name="description" content="	UPDATED: Please check out this post to see how I would solve it nowadays. Maybe still not perfect, but a lot better than the solution provided below.">

  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/main.css">
  
<!--  <link rel="stylesheet" href="/css/main.css"> -->
  <link rel="canonical" href="http://cocoa.ninja/posts/NSURLConnection-in-own-thread">
  <link rel="alternate" type="application/rss+xml" title="cocoa.ninja" href="http://cocoa.ninja/feed.xml" />
  
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>	    
      <a class="navbar-brand" href="/">
         cocoa.ninja
      </a>
    </div>
  
	  <div class="collapse navbar-collapse">
	      <ul class="nav navbar-nav navbar-right">
		      <li>
			  	<a href="https://twitter.com/depl0y">
					<img src="/img/svg/twitter.svg">
				</a>
	        
			</li>
	     
			<li class="icon  icon--github">
				<a href="https://github.com/depl0y">
					<img src="/img/svg/github.svg">
				</a>
			</li>	 
		
		
			<li class="icon icon--mail">
				<a href="mailto:wim@sortedbits.com">
					<img src="/img/svg/mail.svg">
				</a>
			</li>
			
			<li class="icon icon--so">
				<a href="http://stackoverflow.com/users/69313/wim-haanstra">
					<img src="/img/svg/stackoverflow.svg">
				</a>
			</li>
			
			
			<li class="icon icon--so">
				<a href="skype:wimhaanstra" id="skype_call_wim">
					<img src="/img/svg/skype.svg">
				</a>
			</li>
	  	</ul>
	  </div>
  </div>
</nav>


    <div class="container">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">NSURLConnection in its own thread</h1>
  </header>
</div>

<div class="post-info">
	<div class="author-avatar">
		<img src="http://www.gravatar.com/avatar/0ec84fc5efb4f0dc7db5df8bf6bb41b9.png">
	</div>
	<div class="details">
		<div class="row">
			<div class="col-md-12 author-name">
				Wim Haanstra
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 post-subtitle">
				This post was created on <span class="post-date">February 9, 2009</span>.
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 tags">
		   		
		   			<span class="tag">objC</span>
		   		
			</div>
		</div>
	</div>
</div>


<div class="post">
  <article class="post-content">
    <div class="alert alert-warning">
	<strong>UPDATED</strong>: Please check out <a href="http://cocoa.ninja/posts/async-downloading-of-data/">this post</a> to see how I would solve it nowadays. Maybe still not perfect, but a lot better than the solution provided below.
</div>

<!-- more -->
<p>I am currently working on perfecting my new AppReviews application. It sure coming along nicely but I ran into some trouble. Because I am pulling a lot of data from the web, I wanted to update a progress bar when data arrives and show the user some progress. Of course you can normally do this by putting your web activity in a separate thread and making sure that thread notifies your main thread when changes occur. Well, in Cocoa this isn’t that simple. For my web activities I created a new class and when I want to pull data from the web I do that by putting it in it’s own thread.</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="lineno">1</span> <span class="bp">NSString</span><span class="o">*</span> <span class="n">url</span> <span class="o">=</span> <span class="s">@&quot;http://your.url/here&quot;</span><span class="p">;</span>
<span class="lineno">2</span> <span class="bp">NSURL</span><span class="o">*</span> <span class="n">nsurl</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="n">url</span><span class="p">];</span>
<span class="lineno">3</span> <span class="bp">NSMutableURLRequest</span><span class="o">*</span> <span class="n">urlReq</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSMutableURLRequest</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithURL</span><span class="p">:</span><span class="n">nsurl</span><span class="p">];</span>
<span class="lineno">4</span> <span class="bp">NSURLConnection</span> <span class="o">*</span><span class="n">conn</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSURLConnection</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithRequest</span><span class="p">:</span><span class="n">urlReq</span> <span class="nl">delegate</span><span class="p">:</span><span class="nb">self</span><span class="p">];</span></code></pre></div>

<p>My class contains all the necessary delegate methods like :</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="lineno">1</span> <span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">connection:</span><span class="p">(</span><span class="bp">NSURLConnection</span> <span class="o">*</span><span class="p">)</span><span class="nv">connection</span> <span class="nf">didReceiveData:</span><span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="p">)</span><span class="nv">data</span><span class="p">;</span>
<span class="lineno">2</span> <span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">connectionDidFinishLoading:</span><span class="p">(</span><span class="bp">NSURLConnection</span> <span class="o">*</span><span class="p">)</span><span class="nv">connection</span><span class="p">;</span></code></pre></div>

<p>But once the NSURLConnection is launched in a seperate thread, the delegate methods do not get triggered anymore. This probably because the thread is finished before your class actually executed all it’s code. After you initialized the NSURLConnection object, you actually need to put the class in an infinite loop to make sure the class is still alive when the delegate methods are hit. For example: <script src="https://gist.github.com/depl0y/1302265.js"> </script></p>

<p><code>finished</code> is a bool variable, which declare in your</p>

<p>Hope this helps some people out, because this bugged for a while…..</p>

  </article>
</div>


<div id="disqus_thread" class="comments">
  <script type="text/javascript">
      var disqus_shortname = 'cocoaninja';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


    </div>

    <footer class="footer">
	<div class="container">
		<p class="text-muted">&copy; 2015 - Wim Haanstra</p>
	</div>
</footer>

	<script type="text/javascript" src="/js/jquery-1.11.2.min.js"></script>
	<script type="text/javascript" src="/js/bootstrap.min.js"></script>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	
	  ga('create', 'UA-15884210-11', 'auto');
	  ga('send', 'pageview');
	
	</script>
	
  </body>

</html>
