<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Reading big XML file with C# XmlReader</title>
  <meta name="description" content="Today I needed to parse a LARGE (1.9GB) XML file and extract some information from it. Loading it in a XmlDocument (my favorite .NET way of handling XML) was...">

  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/main.css">
  
<!--  <link rel="stylesheet" href="/css/main.css"> -->
  <link rel="canonical" href="http://cocoa.ninja/posts/reading-big-xml-file-with-c-xmlreader">
  <link rel="alternate" type="application/rss+xml" title="cocoa.ninja" href="http://cocoa.ninja/feed.xml" />
  
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>	    
      <a class="navbar-brand" href="/">
         cocoa.ninja
      </a>
    </div>
  
	  <div class="collapse navbar-collapse">
	      <ul class="nav navbar-nav navbar-right">
		      <li>
			  	<a href="https://twitter.com/depl0y">
					<img src="/img/svg/twitter.svg">
				</a>
	        
			</li>
	     
			<li class="icon  icon--github">
				<a href="https://github.com/depl0y">
					<img src="/img/svg/github.svg">
				</a>
			</li>	 
		
		
			<li class="icon icon--mail">
				<a href="mailto:wim@sortedbits.com">
					<img src="/img/svg/mail.svg">
				</a>
			</li>
			
			<li class="icon icon--so">
				<a href="http://stackoverflow.com/users/69313/wim-haanstra">
					<img src="/img/svg/stackoverflow.svg">
				</a>
			</li>
			
			
			<li class="icon icon--so">
				<a href="skype:wimhaanstra" id="skype_call_wim">
					<img src="/img/svg/skype.svg">
				</a>
			</li>
	  	</ul>
	  </div>
  </div>
</nav>


    <div class="container">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Reading big XML file with C# XmlReader</h1>
  </header>
</div>

<div class="post-info">
	<div class="author-avatar">
		<img src="http://www.gravatar.com/avatar/0ec84fc5efb4f0dc7db5df8bf6bb41b9.png">
	</div>
	<div class="details">
		<div class="row">
			<div class="col-md-12 author-name">
				Wim Haanstra
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 post-subtitle">
				This post was created on <span class="post-date">February 1, 2010</span>.
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 tags">
		   		
		   			<span class="tag">C#</span>
		   		
			</div>
		</div>
	</div>
</div>


<div class="post">
  <article class="post-content">
    <p>Today I needed to parse a <strong>LARGE</strong> (1.9GB) XML file and extract some information from it. Loading it in a XmlDocument (my favorite .NET way of handling XML) wasn't really a possibility, because that would cause Out of Memory errors the minute I would try it.</p>
<!-- more -->
<p>I am using a XmlReader for this and I noticed that there aren't really many usable examples on the internet about this, so here is just a small example I created to show how you could read a RSS feed.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="lineno"> 1</span> <span class="c1">// File to open up, can be an URL too</span>
<span class="lineno"> 2</span> <span class="kt">string</span> <span class="n">XmlFileUrl</span> <span class="p">=</span> <span class="s">@&quot;c:\feed.xml&quot;</span><span class="p">;</span>
<span class="lineno"> 3</span> <span class="k">using</span> <span class="p">(</span><span class="n">XmlReader</span> <span class="n">reader</span> <span class="p">=</span> <span class="k">new</span> <span class="n">XmlTextReader</span><span class="p">(</span><span class="n">XmlFileUrl</span><span class="p">))</span>
<span class="lineno"> 4</span> <span class="p">{</span>
<span class="lineno"> 5</span> 	<span class="c1">// Initialize a list for storage of the items</span>
<span class="lineno"> 6</span> 	<span class="n">List</span> <span class="n">items</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">();</span>
<span class="lineno"> 7</span> 	<span class="c1">// boolean to see if a node was opened before</span>
<span class="lineno"> 8</span> 	<span class="kt">bool</span> <span class="n">openItem</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="lineno"> 9</span> 	<span class="n">RssItem</span> <span class="n">item</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RssItem</span><span class="p">();</span>
<span class="lineno">10</span> 
<span class="lineno">11</span> 	<span class="c1">// Loop the reader, till it cant read anymore</span>
<span class="lineno">12</span> 	<span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">Read</span><span class="p">())</span>
<span class="lineno">13</span> 	<span class="p">{</span>
<span class="lineno">14</span> 		<span class="c1">// An object with the type Element was found.</span>
<span class="lineno">15</span> 		<span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">NodeType</span> <span class="p">==</span> <span class="n">XmlNodeType</span><span class="p">.</span><span class="n">Element</span><span class="p">)</span>
<span class="lineno">16</span> 		<span class="p">{</span>
<span class="lineno">17</span> 			<span class="c1">// Check name of the node and write the contents in the object accordingly.</span>
<span class="lineno">18</span> 			<span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">&quot;item&quot;</span><span class="p">)</span>
<span class="lineno">19</span> 			<span class="p">{</span>
<span class="lineno">20</span> 				<span class="n">item</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RssItem</span><span class="p">();</span>
<span class="lineno">21</span> 				<span class="n">openItem</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="lineno">22</span> 			<span class="p">}</span>
<span class="lineno">23</span> 			<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">&quot;title&quot;</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">openItem</span><span class="p">)</span>
<span class="lineno">24</span> 				<span class="n">item</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">ReadElementContentAsString</span><span class="p">();</span>
<span class="lineno">25</span> 			<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">&quot;link&quot;</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">openItem</span><span class="p">)</span>
<span class="lineno">26</span> 				<span class="n">item</span><span class="p">.</span><span class="n">link</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">ReadElementContentAsString</span><span class="p">();</span>
<span class="lineno">27</span> 			<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">&quot;description&quot;</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">openItem</span><span class="p">)</span>
<span class="lineno">28</span> 				<span class="n">item</span><span class="p">.</span><span class="n">description</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">ReadElementContentAsString</span><span class="p">();</span>
<span class="lineno">29</span> 		<span class="p">}</span>
<span class="lineno">30</span> 		<span class="c1">// EndElement was found, check if it is named item, if it is, store the object in the list and set openItem to false.</span>
<span class="lineno">31</span> 		<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">NodeType</span> <span class="p">==</span> <span class="n">XmlNodeType</span><span class="p">.</span><span class="n">EndElement</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">reader</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">&quot;item&quot;</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">openItem</span><span class="p">)</span>
<span class="lineno">32</span> 		<span class="p">{</span>
<span class="lineno">33</span> 			<span class="n">openItem</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="lineno">34</span> 			<span class="n">items</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="lineno">35</span> 		<span class="p">}</span>
<span class="lineno">36</span> 	<span class="p">}</span>
<span class="lineno">37</span> <span class="p">}</span></code></pre></div>

<p>The <strong>RssItem</strong> class I created is just a simple class containing a couple of properties:</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="lineno">1</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">RssItem</span>
<span class="lineno">2</span> <span class="p">{</span>
<span class="lineno">3</span> 	<span class="k">public</span> <span class="kt">string</span> <span class="n">title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">4</span> 	<span class="k">public</span> <span class="kt">string</span> <span class="n">pubDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">5</span> 	<span class="k">public</span> <span class="kt">string</span> <span class="n">link</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">6</span> 	<span class="k">public</span> <span class="kt">string</span> <span class="n">description</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="lineno">7</span> <span class="p">}</span></code></pre></div>


  </article>
</div>


<div id="disqus_thread" class="comments">
  <script type="text/javascript">
      var disqus_shortname = 'cocoaninja';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


    </div>

    <footer class="footer">
	<div class="container">
		<p class="text-muted">&copy; 2015 - Wim Haanstra</p>
	</div>
</footer>

	<script type="text/javascript" src="/js/jquery-1.11.2.min.js"></script>
	<script type="text/javascript" src="/js/bootstrap.min.js"></script>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	
	  ga('create', 'UA-15884210-11', 'auto');
	  ga('send', 'pageview');
	
	</script>
	
  </body>

</html>
